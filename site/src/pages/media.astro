---
import Layout from '~/layouts/PageLayout.astro';
// Page-scoped GLightbox init for Media (CDN-only)
import { youtubePerformances, spotifyAlbums } from '~/data/media/youtube-performances.js';

const metadata = {
  title: 'Media | Bree Lowdermilk',
  description: 'Celebrity performances and recordings of Kerrigan-Lowdermilk songs',
  openGraph: {
    title: 'Media | Bree Lowdermilk',
    description: 'Watch Broadway stars perform Kerrigan-Lowdermilk songs',
    type: 'website'
  }
};

// Get actual image paths from existing media folder
const getCelebrityImage = (performer) => {
  const imageMap = {
    'Aaron Tveit': '/src/assets/images/media/aaron tveit.jpg',
    'Jeremy Jordan': '/src/assets/images/media/jeremy jordan.jpg',
    'Rachel Zegler': '/src/assets/images/media/rachel zegler.jpg',
    'Keala Settle': '/src/assets/images/media/keala settle.avif',
    'Emma Hunton': '/src/assets/images/media/go-tonight.png',
    'Emma Hunton & Krystina Alabado': '/src/assets/images/media/go-tonight.png',
    'Grant Gustin': '/src/assets/images/media/grant gustin.jpg',
    'Sarah Hyland & Melissa Benoist': '/src/assets/images/media/sarah hyland and melissa benoist.png',
    'Colleen Ballinger': '/src/assets/images/media/colleen ballinger.jpg',
    'Colton Haynes': '/src/assets/images/media/colton haynes.webp',
    'Meghann Fahy': '/src/assets/images/media/meghann fahy.png',
    'Michael Arden': '/src/assets/images/media/michael arden andy mientus.png',
    'Andy Mientus': '/src/assets/images/media/michael arden andy mientus.png',
    'Andy Mientus & Colton Haynes': '/src/assets/images/media/michael arden andy mientus.png',
    'Andy Mientus & Steven Booth': '/src/assets/images/media/michael arden andy mientus.png',
    'Uzo Aduba': '/src/assets/images/media/uzo aduba.webp',
    'Ciara RenÃ©e': '/src/assets/images/media/ciara renee.jpeg',
    'Sutton Foster': '/src/assets/images/media/sutton foster.jpg',
    'Lindsay Mendez': '/src/assets/images/media/lindsay-mendez.jpeg',
    'Lindsay Mendez & Andy Mientus': '/src/assets/images/media/michael arden andy mientus.png',
    'Andy Mientus & Krysta Rodriguez': '/src/assets/images/media/michael arden andy mientus.png',
    'Laura Osnes': '/src/assets/images/media/laura-osnes.jpg',
    'Mandy Gonzalez': null,
    'Carrie Manolakos': null
  };
  
  for (const [key, path] of Object.entries(imageMap)) {
    if (performer.includes(key)) {
      return path;
    }
  }
  return null;
};

// Get YouTube thumbnail as fallback
const getYouTubeThumbnail = (youtubeId) => {
  if (!youtubeId) return null;
  return `https://img.youtube.com/vi/${youtubeId}/hqdefault.jpg`;
};

// Verified working YouTube IDs - only include ones we're 100% sure about
const workingYouTubeIds = {
  'Aaron Tveit': '61EL69OZSlY',  // Run Away With Me - verified
  'Jeremy Jordan': 'jVwtGU3KOro',  // Run Away With Me - verified
  'Rachel Zegler': 'Z9ZMLjLqAgE',  // Anyway - verified
  'Lindsay Mendez': 'Gt76Mf6yAEo',  // Hand in Hand - verified
  'Keala Settle': 'XLFEvHWD_NE',  // Holding On - verified
};

// Prepare performance data with images and URLs
const performanceData = youtubePerformances.filter(perf => perf.priority <= 2).map((performance) => {
  const celebrityImage = getCelebrityImage(performance.performer);
  const imageUrl = celebrityImage || getYouTubeThumbnail(performance.youtubeId);
  
  // Use working YouTube ID if available
  let youtubeId = performance.youtubeId;
  for (const [performer, id] of Object.entries(workingYouTubeIds)) {
    if (performance.performer.includes(performer)) {
      youtubeId = id;
      break;
    }
  }
  
  const youtubeUrl = youtubeId 
    ? `https://www.youtube.com/watch?v=${youtubeId}`
    : `https://www.youtube.com/results?search_query=${encodeURIComponent(performance.searchQuery || `${performance.performer} ${performance.title} Kerrigan Lowdermilk`)}`;
  
  return {
    ...performance,
    imageUrl,
    youtubeUrl,
    youtubeId
  };
}).filter(p => p.imageUrl && p.imageUrl !== 'null'); // Only include items with valid images
---

<Layout metadata={metadata}>
  <!-- GLightbox CSS/JS (CDN) and page-scoped init for video links -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
  <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js" defer></script>
  <script is:inline>
    const setupMediaLightbox = () => {
      if (!window.GLightbox) { setTimeout(setupMediaLightbox, 60); return; }
      if (window.__mediaLightbox) { try { window.__mediaLightbox.destroy(); } catch {} }
      window.__mediaLightbox = window.GLightbox({
        selector: 'a.glightbox',
        loop: true,
        touchNavigation: true,
        closeOnOutsideClick: true,
        openEffect: 'fade',
        closeEffect: 'fade',
        slideEffect: 'slide',
        autoplayVideos: false,
      });
      try { console.log(`[media] GLightbox bound: `, document.querySelectorAll('a.glightbox').length); } catch {}
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupMediaLightbox);
    } else {
      setupMediaLightbox();
    }
    document.addEventListener('astro:page-load', setupMediaLightbox);
  </script>
  
  <!-- Header Section - Matching About/Contact style -->
  <section class="px-4 py-16 mx-auto max-w-6xl lg:px-8 lg:py-20">
    <h1 class="bree-h1-small mb-8">Media</h1>
    
    <!-- Celebrity Performances Grid - Regular sized grid -->
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
      {performanceData.slice(0, 20).map((performance) => (
        <div class="group relative aspect-square overflow-hidden rounded-lg shadow-md hover:shadow-xl transition-all duration-300">
          <a
            href={performance.youtubeUrl}
            class="glightbox block relative overflow-hidden h-full"
            data-gallery="performances"
            data-title={performance.title}
            data-description={`Performed by ${performance.performer}`}
            data-type={performance.youtubeId ? "video" : "external"}
            target={performance.youtubeId ? "_self" : "_blank"}
            rel={performance.youtubeId ? "" : "noopener noreferrer"}
          >
            <img 
              src={performance.imageUrl}
              alt={`${performance.performer} - ${performance.title}`}
              class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
              loading="lazy"
            />
            
            <!-- Gradient Overlay -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
            
            <!-- Text Overlay - Always visible at bottom -->
            <div class="absolute bottom-0 left-0 right-0 p-2 text-white">
              <h3 class="text-sm font-bold mb-0.5 drop-shadow-lg line-clamp-1">
                {performance.performer}
              </h3>
              <p class="text-xs opacity-90 drop-shadow-lg line-clamp-1">
                {performance.title}
              </p>
            </div>
            
            <!-- Play Button on Hover -->
            <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <div class="w-12 h-12 bg-white/90 rounded-full flex items-center justify-center">
                <svg class="w-5 h-5 text-gray-900 ml-0.5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M8 5v14l11-7z"/>
                </svg>
              </div>
            </div>
          </a>
        </div>
      ))}
    </div>

    <!-- Spotify Albums Section -->
    <div class="mt-16">
      <h2 class="text-2xl font-bold mb-6">Albums</h2>
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
        {spotifyAlbums.map((album) => (
          <a
            href={album.spotifyUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="group relative overflow-hidden rounded-lg shadow-md hover:shadow-xl transition-all duration-300"
          >
            <div class="aspect-square">
              <img 
                src={album.coverImage}
                alt={album.title}
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                loading="lazy"
              />
              <div class="absolute inset-0 bg-black/0 group-hover:bg-black/60 transition-all duration-300 flex items-center justify-center">
                <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-white text-center p-3">
                  <h3 class="font-bold text-sm mb-1">{album.title}</h3>
                  <p class="text-xs opacity-90">{album.year}</p>
                  <div class="mt-2">
                    <span class="text-xs bg-green-500 px-2 py-1 rounded-full">Spotify</span>
                  </div>
                </div>
              </div>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>
</Layout>

<style>
/* Text Shadow for better readability */
.drop-shadow-lg {
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.9), 0 1px 2px rgba(0, 0, 0, 0.8);
}

/* Line clamp utility */
.line-clamp-1 {
  overflow: hidden;
  display: -webkit-box;
  -webkit-line-clamp: 1;
  -webkit-box-orient: vertical;
}
</style>
