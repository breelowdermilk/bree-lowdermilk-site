---
import { getCollection } from 'astro:content';
import PageLayout from '~/layouts/PageLayout.astro';
import defaultImg from '~/assets/images/default.png';

const shows = await getCollection('shows');
const sortedShows = shows.sort((a, b) => a.data.title.localeCompare(b.data.title));

const metadata = {
  title: 'Shows - Bree Lowdermilk',
  description: 'Explore musicals and theatrical works by Bree Lowdermilk, featuring original compositions, lyrics, and collaborative projects',
  openGraph: {
    type: 'website',
  },
};
---

<PageLayout {metadata}>
  <section class="px-6 sm:px-6 max-w-7xl mx-auto">
    <div class="py-12 md:py-16 lg:py-20 mx-auto">
      <header class="max-w-3xl mx-auto text-center mb-12">
        <h1 class="text-5xl md:text-6xl font-bold leading-tighter tracking-tighter mb-4 font-heading text-gray-900 dark:text-white">
          Shows
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-400">
          Musical theatre works featuring original music and lyrics by Bree Lowdermilk
        </p>
      </header>

      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        {sortedShows.map((show) => {
          const excerpt = show.data.synopsis 
            ? show.data.synopsis.slice(0, 200) + (show.data.synopsis.length > 200 ? '...' : '')
            : 'Musical theatre work by Bree Lowdermilk';
          
          const imageUrl = show.data.heroImage || defaultImg;
          
          return (
            <article class="bg-white dark:bg-gray-900 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300 hover:scale-105">
              <div class="relative">
                <img 
                  src={imageUrl} 
                  alt={show.data.title || 'Show image'}
                  class="w-full h-64 object-cover"
                  width="400"
                  height="256"
                  loading="lazy"
                />
                <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
              </div>
              
              <div class="p-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-3 line-clamp-2">
                  {show.data.title || 'Untitled Show'}
                </h2>
                
                {show.data.status && (
                  <span class={`inline-block px-3 py-1 text-xs font-medium rounded-full mb-3 ${
                    show.data.status === 'licensed' 
                      ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' 
                      : show.data.status === 'touring'
                      ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'
                      : show.data.status === 'development'
                      ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200'
                      : 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200'
                  }`}>
                    {show.data.status.charAt(0).toUpperCase() + show.data.status.slice(1)}
                  </span>
                )}
                
                <p class="text-gray-600 dark:text-gray-400 mb-4 text-sm leading-relaxed line-clamp-4">
                  {excerpt}
                </p>
                
                {show.data.credits && show.data.credits.length > 0 && (
                  <div class="mb-4">
                    <p class="text-xs text-gray-500 dark:text-gray-500 font-medium mb-1">Credits</p>
                    <div class="text-xs text-gray-600 dark:text-gray-400">
                      {show.data.credits.slice(0, 2).map((credit, index) => (
                        <p class="mb-0.5">{credit}</p>
                      ))}
                      {show.data.credits.length > 2 && (
                        <p class="text-gray-500">+{show.data.credits.length - 2} more</p>
                      )}
                    </div>
                  </div>
                )}
                
                <div class="flex justify-between items-center">
                  {show.data.links?.licensing && (
                    <a 
                      href={show.data.links.licensing}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="inline-flex items-center text-sm text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 font-medium"
                    >
                      Licensing â†’
                    </a>
                  )}
                  
                  {show.data.pressQuotes && show.data.pressQuotes.length > 0 && (
                    <div class="flex items-center text-xs text-gray-500">
                      <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                      </svg>
                      {show.data.pressQuotes.length} review{show.data.pressQuotes.length !== 1 ? 's' : ''}
                    </div>
                  )}
                </div>
              </div>
            </article>
          );
        })}
      </div>
      
      {sortedShows.length === 0 && (
        <div class="text-center py-12">
          <p class="text-gray-600 dark:text-gray-400">No shows available at this time.</p>
        </div>
      )}
    </div>
  </section>
</PageLayout>
